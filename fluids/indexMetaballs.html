<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<head>
		<title>Metaballs</title>
		<style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
			body {
				background: black;
			}			
			canvas {
				display: block;
                background: black;
                /*filter: blur(10px) contrast(20);*/
			}
		</style>
	</head>
	
	<body>
        <span style="color:white">Blur/Contrast Size:</span>
        <input type = "range" id="slider" min = "8" max = "50" step = "1" value="20" class = "slider" oninput="sliderValue()"><br> 
        <canvas id="canvas1"></canvas>
        <script>
            var filter = "blur(10px) contrast(20)";
            var slider = document.getElementById('slider');
            const canvas = document.getElementById("canvas1");
            const ctx = canvas.getContext("2d");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            canvas.style.filter = filter;
            ctx.fillStyle = 'yellow';//getColor(Math.random(),Math.random(),Math.random());
            ctx.strokeStyle = 'red';//getColor(Math.random(),Math.random(),Math.random());

            function sliderValue(){
                canvas.style.filter = "blur("+slider.value/2 + "px) contrast("+slider.value+")";
            }

            class Ball{
                constructor(effect){
                    this.effect = effect;
                    this.radius = Math.random() * 80 + 20;
                    this.x = Math.random() * this.effect.width;//this.effect.width * 0.5;
                    this.y = Math.random() * this.effect.height;//this.effect.height * 0.5;
                    if(this.x < this.radius) this.x = this.radius;
                    if(this.x > this.effect.width - this.radius) this.x = this.effect.width - this.radius;
                    if(this.y < this.radius) this.y = this.radius;
                    if(this.x > this.effect.height - this.radius) this.y = this.effect.height - this.radius;
                    this.speedX = Math.random() - 0.5;
                    this.speedY = Math.random() - 0.5;
                    this.angle = 0;
                    this.va = Math.random() * 0.1 - 0.05;
                    this.range = Math.random() * 20;
                    // var gradient = ctx.createRadialGradient(this.x,this.y,2,this.x,this.y,this.radius);
                    // gradient.addColorStop(0, "yellow");
                    // gradient.addColorStop(0.9, "white");
                    // gradient.addColorStop(1, "black");
                    // this.strokeColor = gradient;
                    // this.fillColor = "red";//gradient;//getColor(Math.random(),Math.random(),Math.random());
                }
                update(){
                    if(this.x < this.radius || this.x > this.effect.width - this.radius)this.speedX *= -1;
                    if(this.y < this.radius || this.y > this.effect.height - this.radius)this.speedY *= -1;
                    this.angle += this.va;
                    this.x += this.speedX * Math.sin(this.angle) * this.range;
                    this.y += this.speedY * Math.sin(this.angle) * this.range;
                }
                draw(context){
                    context.beginPath();
                    context.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    //console.log(this.x + " "+this.y + " "+ this.radius);
                    //context.fillStyle = this.fillColor;
                    context.fill();
                    context.lineWidth=4;
                    //context.strokeStyle=this.strokeColor;
                    context.stroke();
                }
                reset(){
                    this.x = this.effect.width * 0.5;
                    this.y = this.effect.height * 0.5; 
                }
            }

            class MetaballsEffect{
                constructor(width, height){
                    this.width = width;
                    this.height = height;
                    this.metaballsArray = [];
                }
                init(numberOfBalls){
                    for(let i=0; i<numberOfBalls; i++){
                        this.metaballsArray.push(new Ball(this));
                    }
                }
                update(){
                    this.metaballsArray.forEach(metaball => metaball.update());
                }
                draw(context){
                    this.metaballsArray.forEach(metaball => metaball.draw(context));
                }
                reset(newWidth, newHeight){
                    this.width = newWidth;
                    this.height = newHeight;
                    this.metaballsArray.forEach(metaball => metaball.reset());
                }
            }

            const effect = new MetaballsEffect(canvas.width, canvas.height);
            effect.init(20);

            function animate(){
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                effect.update();
                effect.draw(ctx);
                requestAnimationFrame(animate);
            }

            animate();

            window.addEventListener('resize', function(){
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                ctx.fillStyle = 'white';
                effect.reset(canvas.width, canvas.height);
            });

            function getColor(r,g,b) {
                return `rgb(
                    ${Math.floor(255*r)},
                    ${Math.floor(255*g)},
                    ${Math.floor(255*b)})`
            }
        </script>
    </body>
</html>